{% extends "base.html" %} {% load static %} {% block content %}
<div class="container mt-4">
  {% if no_access %}
  <div class="alert alert-danger">
    You do not have permission to view this post.
  </div>
  <a href="{% url 'post_list' %}" class="btn btn-secondary">Back to Feed</a>
  {% else %}
  <!-- Post Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="d-flex align-items-center mb-2">
        <img
          src="{{ post.author.profile.avatar.url|default:'/static/images/default-avatar.png' }}"
          class="rounded-circle me-2"
          width="40"
          height="40"
          alt="{{ post.author.username }}"
        />

        <div>
          <a
            href="{% url 'accounts:profile' post.author.username %}"
            class="fw-bold text-decoration-none"
          >
            {{ post.author.username }}
          </a>
          <div class="text-muted small">
            {{ post.created_at|date:"M d, Y H:i" }}
          </div>
        </div>
      </div>

      <p class="mt-2">{{ post.text }}</p>

      {% if post.image %}
      <div class="d-flex flex-row justify-content-center">
        <img
          src="{{ post.image.url }}"
          class="img-fluid rounded mb-2"
          alt="Post image"
        />
      </div>
      {% endif %}

      <p class="small text-muted">Privacy: {{ post.get_privacy_display }}</p>

      <!-- Like Button -->
      <form
        method="post"
        action="{% url 'toggle_like' post.pk %}"
        class="d-inline"
      >
        {% csrf_token %}
        <button
          type="submit"
          class="btn btn-sm {% if liked_by_user %}btn-danger{% else %}btn-outline-danger{% endif %}"
        >
          <i class="bi bi-heart{% if liked_by_user %}-fill{% endif %}"></i>
          {% if liked_by_user %} Unlike {% else %} Like {% endif %}
        </button>
      </form>
      <span class="ms-2 text-muted">{{ post.likes.count }} like(s)</span>
    </div>
  </div>

  <!-- Comments Section -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Comments</h5>
      {% if post.comments.all %} {% for comment in post.comments.all %}
      <div class="mb-2">
        <strong>{{ comment.user.username }}</strong>: {{ comment.content }}
      </div>
      {% endfor %} {% else %}
      <p class="text-muted">No comments yet.</p>
      {% endif %}

      <hr />
      <form method="post" action="{% url 'add_comment' post.pk %}" class="mt-3">
        {% csrf_token %} {% for field in comment_form %}
        <div class="mb-3">
          <label for="{{ field.id_for_label }}" class="form-label"
            >{{ field.label }}</label
          >
          {{ field }} {% for error in field.errors %}
          <div class="alert alert-danger mt-1">{{ error }}</div>
          {% endfor %}
        </div>
        {% endfor %}

        <button type="submit" class="btn btn-primary btn-sm mt-2">
          Add Comment
        </button>
      </form>
    </div>
  </div>

  <div class="mt-3">
    <a href="{% url 'post_list' %}" class="btn btn-secondary btn-sm m-2"
      >Back to Feed</a
    >
  </div>
  {% endif %}
</div>
{% endblock %}
